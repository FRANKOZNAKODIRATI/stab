<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stake Mines Game with Balance & Cashout</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .controls {
      margin-bottom: 15px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }
    label {
      font-size: 14px;
    }
    input, select {
      padding: 5px;
      border-radius: 5px;
      border: none;
      margin-left: 5px;
    }
    #game {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      grid-template-rows: repeat(5, 60px);
      gap: 8px;
      margin-bottom: 20px;
    }
    .tile {
      width: 60px;
      height: 60px;
      background: #333;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 30px;
      user-select: none;
      transition: background 0.3s;
    }
    .tile.revealed {
      background: #444;
      cursor: default;
    }
    .tile.diamond {
      color: #00ffcc;
    }
    .tile.mine {
      color: red;
    }
    #status {
      margin-bottom: 10px;
    }
    #restartBtn, #cashOutBtn {
      padding: 10px 20px;
      background: #00bfa5;
      border: none;
      border-radius: 6px;
      color: #121212;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    #restartBtn:hover, #cashOutBtn:hover {
      background: #00e0c1;
    }
    .balance {
      margin-bottom: 10px;
      font-size: 18px;
    }
  </style>
</head>
<body>

<h1>Stake Mines Game</h1>

<div class="balance">
  Balance: $<span id="balance">10.00</span> | Winnings: $<span id="winnings">0.00</span>
</div>

<div class="controls">
  <label>
    Bet: $
    <input type="number" id="betAmount" min="0.1" step="0.1" value="1" />
  </label>
  <label>
    Mines:
    <select id="mineCount"></select>
  </label>
  <button id="restartBtn">Start Game</button>
  <button id="cashOutBtn" style="display:none;">Cash Out</button>
</div>

<div id="status">Click "Start Game" to play!</div>
<div id="game"></div>

<script>
  const rows = 5;
  const cols = 5;
  const totalTiles = rows * cols;

  const gameEl = document.getElementById('game');
  const statusEl = document.getElementById('status');
  const restartBtn = document.getElementById('restartBtn');
  const cashOutBtn = document.getElementById('cashOutBtn');
  const mineCountSelect = document.getElementById('mineCount');
  const betInput = document.getElementById('betAmount');
  const balanceEl = document.getElementById('balance');
  const winningsEl = document.getElementById('winnings');

  let mines = new Set();
  let revealedTiles = 0;
  let gameOver = false;
  let diamondsToFind = 0;

  let balance = 10;
  let bet = 1;
  let winnings = 0;

  // Populate mine selector
  for (let i = 1; i <= 24; i++) {
    const option = document.createElement('option');
    option.value = i;
    option.textContent = i;
    mineCountSelect.appendChild(option);
  }

  function placeMines(count) {
    mines.clear();
    while (mines.size < count) {
      const rand = Math.floor(Math.random() * totalTiles);
      mines.add(rand);
    }
  }

  function updateStatus(msg) {
    statusEl.textContent = msg;
  }

  function updateBalanceDisplay() {
    balanceEl.textContent = balance.toFixed(2);
    winningsEl.textContent = winnings.toFixed(2);
  }

  function revealTile(tile, index) {
    if (tile.classList.contains('revealed') || gameOver) return;

    tile.classList.add('revealed');

    if (mines.has(index)) {
      tile.textContent = 'ðŸ’£';
      tile.classList.add('mine');
      balance = Math.max(0, balance - 1); // no negatives here
      winnings = 0;
      updateBalanceDisplay();
      revealAll();
      updateStatus(`ðŸ’¥ You hit a bomb! You lost $1.`);
      gameOver = true;
      cashOutBtn.style.display = 'none';
    } else {
      tile.textContent = 'ðŸ’Ž';
      tile.classList.add('diamond');
      revealedTiles++;

      winnings = bet * 1.5 * revealedTiles;

      updateBalanceDisplay();

      if (revealedTiles === diamondsToFind) {
        updateStatus(`ðŸŽ‰ You found all diamonds! Winnings: $${winnings.toFixed(2)}`);
        revealAll();
        cashOutBtn.style.display = 'none';
        gameOver = true;
      } else {
        updateStatus(`Diamonds found: ${revealedTiles} / ${diamondsToFind}. Winnings: $${winnings.toFixed(2)}`);
        if (revealedTiles > 0) {
          cashOutBtn.style.display = 'inline-block';
        }
      }
    }
  }

  function revealAll() {
    for (let i = 0; i < totalTiles; i++) {
      const tile = gameEl.children[i];
      if (!tile.classList.contains('revealed')) {
        if (mines.has(i)) {
          tile.textContent = 'ðŸ’£';
          tile.classList.add('revealed', 'mine');
        } else {
          tile.textContent = 'ðŸ’Ž';
          tile.classList.add('revealed', 'diamond');
        }
      }
    }
  }

  function startGame() {
    bet = parseFloat(betInput.value);
    if (isNaN(bet) || bet <= 0) {
      alert('Please enter a valid bet amount.');
      return;
    }
    if (bet > balance) {
      alert('Your bet cannot be greater than your current balance.');
      return;
    }

    const mineCount = parseInt(mineCountSelect.value);

    revealedTiles = 0;
    gameOver = false;
    diamondsToFind = totalTiles - mineCount;
    winnings = 0;

    balance -= bet;
    updateBalanceDisplay();

    gameEl.innerHTML = '';
    placeMines(mineCount);

    for (let i = 0; i < totalTiles; i++) {
      const tile = document.createElement('div');
      tile.classList.add('tile');
      tile.dataset.index = i;
      tile.addEventListener('click', () => revealTile(tile, i));
      gameEl.appendChild(tile);
    }

    updateStatus(`Diamonds found: 0 / ${diamondsToFind}. Place your bet and reveal tiles.`);
    cashOutBtn.style.display = 'none'; // hide cash out initially
  }

  function cashOut() {
    if (winnings > 0) {
      balance += winnings;
      updateStatus(`ðŸ’° You cashed out $${winnings.toFixed(2)}!`);
      winnings = 0;
      updateBalanceDisplay();
      gameOver = true;
      cashOutBtn.style.display = 'none';
      revealAll();
    }
  }

  restartBtn.addEventListener('click', startGame);
  cashOutBtn.addEventListener('click', cashOut);
  mineCountSelect.value = 1;
  updateBalanceDisplay();
</script>

</body>
</html>
